# .tmux.conf Eric L, UTD
# Edited 12/7/2020

# requirements xclip, fzf, multi-ssh


# fix colors in vim for moonfly?
set -ga terminal-overrides ',xterm-256color:Tc'


#set automatic-rename off
set-window-option -g automatic-rename off
set-option -g allow-rename off


#Names at bottom of panes
set -g pane-border-status top
set -g pane-border-format '#(ps -f --no-headers --pid #{pane_pid} -o args)'


# keep window/pane open on exit/disconnect, Prefix + x to kill pane
set-option -g remain-on-exit on 
#
#
# Respawn Dead pane, good for ssh sessions that die
bind-key R respawn-pane


# Theme
source-file "${HOME}/.tmux-themepack/powerline/block/cyan.tmuxtheme"
	#unbind-key Z
	#unbind-key z
	#unbind-key s
	#unbind-key j


## Join windows: <prefix> s, <prefix> j
bind-key j command-prompt -p "join pane here from s.w.p:"  "join-pane -s '%%'"
bind-key k command-prompt -p "send this pane to s.w.p:"  "join-pane -t '%%'"


# Set display pane time out to 7000 ms
set -g display-panes-time 7000


# Set C-a as the prefix key rather than the default C-b for those used to screen
set-option -g prefix C-a
unbind-key C-b
bind-key C-a send-prefix


# Set splits to \ for horizontal and - for veritcal
bind '\' split-window -h
bind - split-window -v


# split full Horizonal, vertical, using keys for ssh splits NOW
#bind | split-window -h -f
#bind _ split-window -v -f


# Bind Easy pane moves, Alt arrow key, 
# **  maybe add alt hjkl keys so you don't have to move you hand
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D


# Set Mouse on, Copy mode?
#bind -t vi-copy y copy-pipe 'xclip -in -selection clipboard'
#bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'
set-option -g mouse on
set-option -s set-clipboard off


# Copy on selection of text with mouse button release
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -se c -i"


# renumber moved windows to allow contigous numbers
#set-option -g renumber-windows onset-option -g renumber-windows on


# start counts at 1 instead of 0 for session and pane
set -g base-index 1
setw -g pane-base-index 1


# source .tmux.conf, dev version,....
bind-key r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"
#bind D source-file ~/.tmux/dev


# Edit ~/.tmux.conf with Prefix + M ( Uppercase m )
bind-key M split-window -h "vim ~/.tmux.conf"


# Toggle Pane sync on and off with prefix + Z
bind-key C-d  set-window-option synchronize-panes 
bind z resize-pane -Z
bind Z set-window-option synchronize-panes


# Set the default terminal to 'xterm' rather than 'screen'
set -g default-terminal "screen-256color"
#set-option -g default-terminal xterm


# Highlight tab when there is activity from the window
setw -g monitor-activity on
set -g visual-activity on


# Kill session and go to another session
bind-key X confirm-before -p "Kill #S (y/n)?" "run-shell 'tmux switch-client -n \\\; kill-session -t \"\$(tmux display-message -p \"#S\")\"'"


# Bind Control-S so that it creates a new windows, labels it and ssh to that host
bind-key C-S command-prompt "new-window -n %1 'ssh -X del140030@%1'"
    #bind C-s command-prompt -pserver 'neww -n %1 "tmux set -w @myserver \"%1\"; ssh \"%1\""'
    #bind 'C-\' run 'tmux splitw "ssh \"#{@myserver}\""'


# Join to window
bind-key j command-prompt -p "join pane from:"  "join-pane -s '%%'"
#bind-key s command-prompt -p "send pane to:"  "join-pane -t '%%'"


#set-option set-titles on
#set -g pane-border-format "#P: #{pane_current_command}"
set -g set-titles-string "#T"


# vi-style controls for copy mode
setw -g mode-keys vi 
set -g @yank_selection 'primary'
bind P paste-buffer
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle


# Statusbar properties.
set-option -g display-time 7000
	#set -g status-bg blue
	#set -g status-fg white
	#set-window-option -g window-status-current-attr bright,reverse
	#set-window-option -g window-status-current-bg cyan
	#set-window-option -g window-status-current-fg black 


	# show some useful stats but only when tmux is started
	# outside of Xorg, otherwise dwm statusbar shows these already
	#set -g status-right ""
	#set -g status-left ""
	#if '[ -z "$DISPLAY" ]' 'set -g status-left "[#[fg=green] #H #[default]]"'
	#if '[ -z "$DISPLAY" ]' 'set -g status-right "[ #[fg=magenta]#(cat /proc/loadavg | cut -d \" \" -f 1,2,3)#[default] ][ #[fg=cyan,bright]%a %Y-%m-%d %H:%M #[default]]"'
	#if '[ -z "$DISPLAY" ]' 'set -g status-right-length 51' 


# Design Window Tab's on if they are [[ Synchronized, zoomed, normal ]]
set-option -g window-status-format " ::#I:#W#F#{?pane_synchronized,Sync,} "
set-window-option -g window-status-current-format "#{?pane_synchronized,#[bg=red],}#{?window_zoomed_flag,#[bg=orange],}  ::#I:#W#F#{?pane_synchronized,Sync,} "
set-option -g window-status-current-style fg=black,underscore,bg=blue


# Emulate screen's logging feature
bind-key H pipe-pane -o 'cat >>$HOME/#W-tmux.log' \; display-message 'Toggled logging to $HOME/#W-tmux.log'


# Enable mouse and copy?
set -g mouse on
set -g @shell_mode 'vi'


# List of plugins
	#set -g @plugin 'tmux-plugins/tpm'
	#set -g @plugin 'tmux-plugins/tmux-sensible'
	#set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'jimeh/tmux-themepack' 
set -g @plugin 'laktak/extrakto'
set -g @plugin 'sainnhe/tmux-fzf'


# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
	#run '~/.tmux/plugins/tpm/tpm'
	#run-shell ~/clone/path/resurrect.tmux
	#set -g @plugin 'tmux-plugins/tmux-resurrect'


# SSH Split window plugin
set -g @plugin 'pschmitt/tmux-ssh-split'


# SSH Server Split Plug-in settings ( tmux-ssh-split )
set-option -g @ssh-split-keep-cwd "true"
set-option -g @ssh-split-fail "false"
set-option -g @ssh-split-no-shell "false"
set-option -g @ssh-split-verbose "true"
set-option -g @ssh-split-h-key "|"
set-option -g @ssh-split-v-key "_"


# Prefix + <Tab> = fzf items on screen to insert, copy, open, edit
set -g @extrakto_split_size "15"
run-shell ~/.tmux/plugins/extrakto/extrakto.tmux
	#run '~/.tmux/plugins/extrakto/extrakto.tmux'


# run Plugin Manager, should be last line
run -b '~/.tmux/plugins/tpm/tpm'

